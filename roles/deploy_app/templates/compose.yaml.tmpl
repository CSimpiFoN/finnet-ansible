services:
{% for key, value in services.items() %}
  {{ key }}:
    image: {{ value.container_image }}
    environment:
      - Tuning: {{ value.configuration.tuning }}
      - Debug: {{ value.configuration.debug }}
      - "External URL": "{{ value.configuration.external_url }}"
      - Client: "{{ value.configuration.client }}"
      - "Interaction Mode": "{{ value.configuration.interaction_mode }}"
      - "Device ID": {{ value.configuration.device_id }}
    ports:
{% for port in value.ports %}
      - "{{ port.expose_port }}:{{ port.app_listen_port }}"
{% endfor %}
    volumes:
{% for key, value in value.volumes.items() %}
      - {{ key }}:{{ value }}
{% endfor %}
    deploy:
      replicas: {{ value.replicas }}
      resources:
        reservations:
          cpus: "{{ value.reservations.cpu }}"
          memory: {{ value.reservations.memory }}
{% endfor %}

volumes:
{% for key, value in services.items() %}
{% for key, value in value.volumes.items() %}
  {{ key }}:
{% endfor %}
{% endfor %}
